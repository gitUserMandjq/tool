package com.example.tool.common.utils;

public class MeasuresUtils {
    public static void main(String[] args) {
        Double[] d1 = {};
        Double[] d2 = {38.096571428571444,48.625993189557335,41.412890094979694,49.211214953270996,44.855307855626364,47.05248226950354,70.67435897435897,42.7161194029851,42.66037735849052,44.10769230769233,43.22686567164178,53.0140243902439,43.51869918699182,41.66006864988556,47.105084745762724,48.83360752056397,46.50980392156861,45.77422126745434,46.33713033953993,47.770756880733934,46.526635514018686,45.40781414994715,46.82480446927372,47.01676168757121,47.56681766704417,46.19476961394767,46.52564389697648,47.78375165125493,46.59842041312266,43.87610710607618,47.969375736160174,44.761087866108824,42.44842209072976,44.08645294725958,42.73303303303312,42.95583333333329,43.54018218623483,42.492263610315185,50.368848758464964,44.81993392070491,48.61258941344782,43.64130879345608,42.90460460460463,42.652923387096834,44.424088397790044,44.93216931216932,45.14744429882041,45.83536585365859,50.79609756097561,46.117139737991295,55.5357034795764,44.83933588761175,76.57307692307691,60.580722891566275,48.92064935064937,43.74917184265008,44.81800894854587,45.25590465872159,44.14904109589038,46.96363636363637,42.301861702127674,44.130546955624354,44.09735294117643,43.28092417061611,42.64645962732916,44.22534908700321,47.33603707995365,43.899469214437424,44.18197802197802,43.34117647058822,41.903443708609274,43.57431472081218,44.789268867924534,47.021223021582756,43.35977011494251,56.400000000000006,54.18604240282681,52.70543478260867,61.74418262150223,57.580309423347344,59.38531855955677,50.53297872340428,51.95418502202648,49.599999999999994,54.85497771173852,47.51508704061899,41.93655913978492,41.45347490347497,42.228341708542644,42.36349206349206,54.22354740061161,53.747784200385375,125.0262626262626,112.97724867724862,120.13954802259877,111.31552795031058,53.06315086782372,109.80614754098366,51.94537037037038,53.73615084525359,51.34935483870971,49.232279314888046,51.51421628189552,46.95939597315439,48.635231316725985,47.88935447338618,49.5953810623557,56.91332116788325,63.20769230769231,51.85239726027397,48.0596107055961,46.29195652173916,45.6878350515464,42.83434065934065,46.99513108614237,45.13997539975404,45.273889490790964,44.95956719817774,51.17398921832883,46.23772935779814,46.360733549083044,49.747607934655704,46.893654266958414,43.10437881873727,47.28499440089578,48.2569807037457,49.66062111801243,54.840277777777786,46.663573883161554,50.48890306122446,47.874830699774265,51.68166259168709,46.7077192982457,47.49432071269486,45.710744680851064,47.85296089385474,42.962121212121225,43.54032258064518,43.990713324360655,48.52277628032342,48.68100263852247,47.07379310344832,44.75526315789478,42.91319018404905,44.78986272439284,45.76468489892986,44.47889713679747,44.750812567714014,44.00449897750509,43.9513569937369,68.330612244898,47.167995310668275,47.17793939393938,47.56084959816299,47.433296337402844,45.9854838709678,47.94253393665162,46.07864077669904,48.04086265607255,49.50806845965768,56.229180327868896,51.15576271186445,95.32105263157894,54.640134228187954,39.952345215759884,40.43154362416098,39.40813165537263,38.570848708487055,75.40538461538456,60.41001964636543,79.44242424242428,61.73826714801443,57.18477653631281,53.920731707317074,71.81159420289853,44.71289954337899,82.64210526315789,46.89867841409694,41.36437125748503,40.279198473282506,41.27934362934359,38.68911070780397,38.89556962025319,38.767361740707145,37.87073813708262,38.52776255707763,37.33148614609573,39.62244604316547,46.47369402985084,44.87220338983053,41.693305439330544,51.021428571428565,50.02842323651458,40.78522072936659,41.962463343108446,42.410710607621006,44.66505771248689,48.067005649717565,48.48275862068966,46.961682242990655,46.500539956803415,46.94209932279906,46.123232323232315,51.65491143317227,55.21776315789473,54.65813953488374,43.75127388535028,45.92419700214128,44.04257731958763,43.13703296703295,45.0836470588235,44.229641025640994,46.655362946912305,45.00313479623821,46.912733260153715,45.866897347174195,49.861240310077434,47.170157657657626,47.57499999999999,48.67054455445539,47.69355932203387,51.14392638036806,47.269066366704095,48.616027874564374,48.600000000000016,57.225806451612904,46.08745644599304,47.186756453423115,47.0974808324206,44.66320166320166,41.91180555555554,79.49272030651348,62.089881956155175,79.15624999999991,62.950769230769176,70.54965753424652,54.71693667157587,70.06777163904233,64.97836990595609,65.17894736842105,72.85416666666669,67.56530612244899,69.36333333333327,63.18530405405407,70.13243243243247,62.62139037433156,73.06025408348461,67.17960687960691,67.93119429590023,65.87901234567902,68.45268292682921,70.97671691792287,72.06588628762547,78.08633093525181,69.66798245614034,68.12296173044918,68.07547770700637,67.09492063492056,67.90947867298578,64.63896713615017,64.32129629629628,68.2056962025316,63.49309262166405,66.14434108527134,70.26632996633,68.63276450511943,70.47635379061364,67.76618122977345,71.6849407783418,78.42307692307692,72.53689320388348,74.73195876288656,79.69177777777773,83.91538461538465,80.56659340659337,79.78684210526313,77.68729582577129,68.26560846560844,79.56237218813905,79.70393374741208,72.62876949740033,69.03134582623508,72.59516539440204,80.38732394366194,73.50136986301365,76.5877289377289,72.43192567567564,71.38979933110366,73.52723735408559,69.21926782273609,63.7006329113924,70.47745266781416,57.680152671755714,51.40684410646392,55.49227467811157,46.986688311688326,49.85498154981554,45.2152582159624,47.89211764705883,44.105888538380604,44.36340956340953,45.208315789473716,44.54849428868122,44.27999999999999,63.711578947368416,71.64511278195488,50.509615384615465,51.79657282741742,57.30331034482768,50.64829760403538,54.145489199491735,59.279859154929675,86.86666666666667,54.515123859191625,53.82939698492466,54.15714285714289,47.9045023696683,101.81138613861386,48.69551886792454,88.34017857142858,60.03617945007239,89.5991525423729,54.075622542595056,55.63478854024562,50.42372262773723,56.84770797962646,53.08295254833041,56.16161764705883,50.94974999999995,45.09706806282724,53.18385826771657,49.46938775510201,47.55175537938849,59.66363636363633,53.23185279187817,48.809826589595446,58.64477401129941,48.101704545454574,46.872486187845325,52.26703431372554,51.068899521531044,51.07405213270145,52.034409937888256,52.2122100122099,55.01315104166665,56.996580027359784,56.84697173620451,57.204564907275376,52.75760111576007,57.09644808743169,54.62621082621086,54.97936507936509,42.437124463519304,48.022546972860134,41.23235294117648,44.567573221757335,41.28172888015717,41.77487636003957,42.596122994652426,41.53039999999999,41.478216818642366,39.70604089219331,39.9727272727273,41.336514522821574,41.640218470705015,42.415921052631575,39.0029356060606,40.19140096618358,40.39681050656658,42.501137538779766,41.76616616616615,40.9756756756757,44.444672657252916,42.07798804780873,45.924376199616106,40.297050428163644,47.01491935483872,43.033772819472624,41.66110038610039,40.380175781249996,39.67826086956524,41.49503858875412,41.92976554536185,38.74740957966763,39.91610486891386,70.69214876033055,69.62424242424242,42.90547808764939,41.30921658986177,39.92759259259257,38.996818181818206,40.06759517177346,39.687057728119164,41.834699999999984,39.88778908418129,41.345689655172436,39.968808193668515,40.860388349514565,41.91493305870237,40.71404174573058,38.91806526806523,38.995372050816705,38.63396226415093,69.73722943722943,65.71816693944353,55.58292367399745,60.39346092503985,42.34018475750578,43.87122302158271,40.16112149532711,41.7543774319066,43.42917505030182,42.6749235474006,50.29883889695212,51.39265944645008,49.348756218905464,46.11020408163265,74.40286738351256,43.44333333333334,67.94561403508771,70.79632352941177,40.00283687943262,40.83538928210313,40.91414242728183,43.43971044467427,40.49539789069991,40.713753581661884,41.93866133866135,42.390594744121714,41.67181286549708,42.20605759682224,40.535424710424714,42.56233635448137,40.45359223300971,41.801911764705885,51.149159663865554,41.23674832962138,41.980432645034405,41.306389157792836,40.920820820820815,51.7294964028777,50.91396648044693,40.181042654028424,40.74173748819641,39.615839694656486,53.325754527162985,64.89621928166352,50.12468513853904,50.605903614457844,47.74039955604885,48.318305084745774,48.24915062287658,46.12857142857143,49.48658959537574,48.40895691609979,47.17012127894156,47.934545454545464,51.94932614555256,55.700751879699254,52.09504792332268,52.02832080200499,61.43393124065768,57.85785123966942,52.37530413625304,54.361868686868696,58.44163208852005,58.98502747252746,50.92603550295856,49.589170506912424,46.677977528089876,57.885000000000005,56.8654069767442,49.54265895953757,53.042431761786624,57.455205479452026,57.845466847090655,51.41925373134326,108.75652173913043,64.22800000000001,53.880583756345196,51.20143027413587,50.15849056603772,50.921317829457365,64.70967741935483,68.59685767097967,71.21644562334217,58.71807228915663,49.06363636363637,62.40927835051547,57.90900243309002,66.35135135135135,63.01845018450183,60.046069182389964,59.65833333333334,47.966716417910455,48.33242320819113,65.67838709677419,94.39026763990266,68.1602766798419,57.13980582524272,56.99589442815249,50.66446540880504,48.87651083238311,47.63699885452463,61.74494845360825,47.421483942414184,47.68596087456846,46.62916666666667,46.41403887688986,51.958616352201254,57.098186528497415,52.10704573547589,57.95047361299053,66.81988636363636,53.20399999999999,47.046082089552236,43.8761316872428,42.89270516717327,42.800199600798415,44.13848920863309,51.84325259515571,45.18928571428571,49.930779220779215,43.31869158878506,41.11374269005848,40.01905660377359,40.847711781889,41.276252983293574,41.57904858299596,40.07623947614593,46.797910447761204,42.289959294436905,47.04993514915695,44.366042780748664,62.7625,40.128190476190476,87.60416666666667,62.370000000000005,61.849770642201825,48.923076923076934,42.44092741935484,58.15196078431372,39.54196428571428,43.7687074829932,75.92916666666666,47.009226190476184,45.41128860489883,49.660520094562656,48.394938132733415,45.57978835978835,45.838560687432874,57.95671191553546,64.03488372093022,71.50991304347826,46.2158918918919,45.86178686759957,43.3949101796407,45.720806794055214,44.62279792746116,43.701939058171746,52.74285714285714,50.74615384615385,46.927876106194695,43.28470464135021,44.14749478079332,45.27069518716577,42.63834951456311,52.2091081593928,54.206426735218514,57.08582995951417,137.725,54.06161048689139,53.353300124533,52.98028720626632,53.83881215469613,54.65456989247312,53.2605459057072,53.51419676214198,54.80050825921218,55.554356306892046,55.179177377892024,55.85271002710027,54.14656652360514,56.82032786885246,56.99504814305364,57.392027972027975,55.12866756393002,57.2780354706685,56.33420689655172,56.56486129458387,55.09059278350516,56.87970822281167,55.55051813471503,56.44383202099736,57.3430534351145,58.54624829467941,55.52916129032258,57.878861788617876,57.70458221024259,57.09578231292518,57.457534246575335,58.988203017832646,56.71390205371248,58.014324693042305,56.72537517053205,71.292,57.40809327846366,63.56627218934911,55.611726804123705,63.513230769230766,55.65006501950585,57.45508021390373,55.229312581063546,57.53056300268096,57.3360107095047,56.71578947368421,54.41607594936709,56.175916230366504,55.94632843791724,55.755921052631585,56.94663805436338,56.75692307692309,58.68695652173913,58.4584379358438,59.55833333333333,58.90404797601198,54.97157622739018,58.34964539007093,57.45480378890393,66.59242902208203,55.59487179487179,65.52757281553397,62.11120943952802,64.47164179104476,56.601597869507316,61.29219653179188,60.70225563909774,82.62862453531598,62.48554216867471,69.86595041322313,63.724537815126034,79.94746666666666};
        {
            //第一种：合并数组计算方差，不按增量算法
            Double[] d3 = hebing(d1,d2);
            Measures m1 = createMs(d3);
            System.out.println("传统计算结果："+m1.getVariance());
        }
        {
            //第二种：方差增量算法
            Measures m2 = createMs(d1);
            Measures m3 = createMs(d2);
            Measures m4 = m2.appendDelta(m3);
            System.out.println("增量算法结果："+m4.getVariance());
        }
        {
            //第二种：方差增量算法,一个一个加
            Measures m2 = createMs(d1);
            for(Double d:d2){
                m2.appendDelta(d);
            }
            System.out.println("增量算法结果："+m2.getVariance());
            System.out.println(Math.pow(Math.sqrt(m2.getVariance()), 2));
        }
    }
    public static class Measures {
        private Integer n;//数组元素个数
        private Double sum;//数组中各元素之和
        private Double variance;//数组方差
        private Double avg;//数组的平均值
        //有参构造器
        public Measures(Integer n, Double sum, Double variance) {
            this.n = n;
            this.sum = sum;
            this.variance = variance;
            if(n == 0){
                this.avg = 0.0;
            }else{
                this.avg =sum/n;
            }
        }
        //数组增量方法
        public Measures appendDelta(Measures delta){
            Integer newN = this.n + delta.getN();//数组长度之和
            Double newSum = this.sum + delta.getSum();//数组元素总和
            Double newAvg = newSum / newN;
            Double variance = (this.partial(newAvg,this.avg,this.variance,this.n) + this.partial(newAvg,delta.getAvg(),delta.getVariance(),delta.getN()))/newN;//方差增量算法公式
            return new Measures(newN,newSum,variance);
        }
        //数组增量方法
        public Measures appendDelta(Double num){
            Integer newN = this.n + 1;//数组长度之和
            Double newSum = this.sum + num;//数组元素总和
            Double newAvg = newSum / newN;
            Double variance = (this.partial(newAvg,this.avg,this.variance,this.n) + this.partial(newAvg,num,0.0,1))/newN;//方差增量算法公式
            this.n = newN;
            this.sum = newSum;
            this.variance = variance;
            this.avg = newAvg;
            System.out.println(newSum + ":" + variance);
            return this;
        }
        // 封装表达式 n*(variance + (newAvg - avg)*(newAvg - avg))
        public Double partial(Double newAvg ,Double avg ,Double variance,Integer n){
            Double deltaAvg =newAvg - avg;
            return n * ( variance + deltaAvg * deltaAvg );
        }

        public Integer getN() {
            return n;
        }

        public void setN(Integer n) {
            this.n = n;
        }

        public Double getSum() {
            return sum;
        }

        public void setSum(Double sum) {
            this.sum = sum;
        }

        public Double getVariance() {
            return variance;
        }

        public void setVariance(Double variance) {
            this.variance = variance;
        }

        public Double getAvg() {
            return avg;
        }

        public void setAvg(Double avg) {
            this.avg = avg;
        }
    }
    /**
     * 单个数组方差的计算
     * @return
     */
    public static Measures createMs(Double[] values){
        Measures ms = null;
        if (values != null && values.length > 0){
            Integer n = values.length;
            //求和
            Double sum =0.00;
            //avg
            Double avg = 0.00;
            //方差计算
            Double variance = 0.00;
            Double sumSq = 0.00;
            for (int i = 0;i<values.length;i++){
                sum +=values[i];
            }
            avg = sum/n;
            for (int i = 0;i<values.length;i++){
                sumSq += Math.pow((values[i] - avg),2);
            }
            variance = sumSq / n;
            ms = new Measures(n,sum,variance);
        }else{
            ms = new Measures(0,0.00,0.00);
        }

        return ms;
    }


    public static  Double[] hebing(Double[] d1,Double[] d2){
        if(d1 == null){
            d1 = new Double[0];
        }
        if(d2 == null){
            d2 = new Double[0];
        }
        Double[] d3 = new Double[d1.length+d2.length];
        for (int i =0;i <d1.length; i++){
            d3[i] = d1[i];
        }
        for(int i =0;i <d2.length; i++){
            d3[i+d1.length] = d2[i];
        }
        return d3;
    }
}
